DROP TABLE IF EXISTS public."Location" CASCADE;
DROP TABLE IF EXISTS public."User" CASCADE;
DROP TABLE IF EXISTS public."UserType" CASCADE;
DROP TABLE IF EXISTS public."Monitoring" CASCADE;
DROP TABLE IF EXISTS public."Measurement" CASCADE;

DROP TABLE IF EXISTS public."SensorType" CASCADE;
DROP TABLE IF EXISTS public."Sensor" CASCADE;
DROP TABLE IF EXISTS public."Box" CASCADE;
DROP TABLE IF EXISTS public."SensorBox" CASCADE;
DROP TABLE IF EXISTS public."BoxUser" CASCADE;




DROP SCHEMA public CASCADE;
CREATE SCHEMA public;

CREATE TABLE public."Box"
(
"BoxID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("BoxID"),
"MacAdress" VARCHAR(300) NOT NULL,
"Name" VARCHAR(300) NOT NULL,
"Comment" VARCHAR(500),
"Active" boolean
);

CREATE TABLE public."UserType"
(
"UserTypeID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("UserTypeID"),
"UserTypeName" VARCHAR(50) NOT NULL
);

CREATE TABLE public."SensorType"
(
"SensorTypeID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("SensorTypeID"),
"Name" VARCHAR(50) NOT NULL,
"Unit" VARCHAR(50) NOT NULL
);
CREATE TABLE public."Users"
(
"UserID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("UserID"),
"LastName" VARCHAR(60) NOT NULL,
"FirstName" VARCHAR(60) NOT NULL,
"Email" VARCHAR(200) NOT NULL,
"Password" VARCHAR(200) NOT NULL,
"Address" VARCHAR(200) ,
"PostalCode" VARCHAR(10),
"City" VARCHAR(100),
"UserTypeID" INT NOT NULL,
CONSTRAINT fk_usertype
FOREIGN KEY("UserTypeID")
REFERENCES "UserType"("UserTypeID")
);
CREATE TABLE public."BoxUser"
(
"BoxUserID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("BoxUserID"),
"BoxID" INT NOT NULL,
"UserID" INT NOT NULL,
"StartDate" timestamp NOT NULL,
"EndDate" timestamp NOT NULL,
CONSTRAINT fk_box
FOREIGN KEY("BoxID")
REFERENCES "Box"("BoxID"),
CONSTRAINT fk_user
FOREIGN KEY("UserID")
REFERENCES "Users"("UserID")
);
CREATE TABLE public."Sensor"
(
"SensorID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("SensorID"),
"Name" VARCHAR(300) NOT NULL,
"SensorTypeID" INT NOT NULL,
CONSTRAINT fk_sensortype
FOREIGN KEY("SensorTypeID")
REFERENCES "SensorType"("SensorTypeID")
);
CREATE TABLE public."SensorBox"
(
"BoxID" INT NOT NULL,
"SensorID" INT NOT NULL,
PRIMARY KEY("BoxID","SensorID"),
CONSTRAINT fk_box
FOREIGN KEY("BoxID")
REFERENCES "Box"("BoxID"),
CONSTRAINT fk_sensor
FOREIGN KEY("SensorID")
REFERENCES "Sensor"("SensorID")
);
CREATE TABLE public."Location"
(
"LocationID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("LocationID"),
"BoxUserID" INT NOT NULL,
"Longtitude" float8 NOT NULL,
"Latitude" float8 NOT NULL,
"StartDate" timestamp NOT NULL,
"EndDate" timestamp NOT NULL,
CONSTRAINT fk_boxuser
FOREIGN KEY("BoxUserID")
REFERENCES "BoxUser"("BoxUserID")
);
CREATE TABLE public."Monitoring"
(
"MonitoringID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("MonitoringID"),
"BoxID" INT NOT NULL,
"TimeStamp" timestamp NOT NULL,
"BatteryStatus" bool,
"SdCapacity" Varchar(50),
"BatteryPercentage" Varchar(10),
CONSTRAINT fk_box
FOREIGN KEY("BoxID")
REFERENCES "Box"("BoxID")
);
CREATE TABLE public."Measurement"
(
"MeasurementID" INT GENERATED ALWAYS AS IDENTITY,
PRIMARY KEY("MeasurementID"),
"BoxID" INT NOT NULL,
"SensorID" INT NOT NULL,
"Value" Varchar(50),
"TimeStamp" timestamp NOT NULL,
CONSTRAINT fk_sensorbox
FOREIGN KEY("BoxID","SensorID")
REFERENCES "SensorBox"("BoxID","SensorID")
/* CONSTRAINT fk_sensorbox
FOREIGN KEY("BoxID")
REFERENCES "SensorBox"("BoxID"),
CONSTRAINT fk_sensorbox
FOREIGN KEY("SensorID")
REFERENCES "SensorBox"("SensorID")*/
);